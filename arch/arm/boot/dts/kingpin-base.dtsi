/*
 * Copyright (C) 2014 Meraki, Inc.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

/include/ "iproc.dtsi"

/ {
        model = "Meraki MX64";
        compatible = "meraki,mx6p", "meraki,kingpin", "meraki,wired-arm-nsp",
			"broadcom,iproc", "bcm,iproc";

        gpiochip: gpio-controller@0000 {
            #gpio-cells = <2>;
            compatible = "iproc,iproc-gpio";
            gpio-controller;
        };

        leds {
                compatible = "gpio-leds";
                white {
                        label = "power:white";
                        gpios = <&gpiochip 31 0>;
                        default-state = "off";
                };
                port0right {
                        label = "port0:right";
                        gpios = <&gpiochip 18 1>;
                        default-state = "off";
                };
                port0left {
                        label = "port0:left";
                        gpios = <&gpiochip 19 1>;
                        default-state = "off";
                };
                port1right {
                        label = "port1:right";
                        gpios = <&gpiochip 20 1>;
                        default-state = "off";
                };
                port1left {
                        label = "port1:left";
                        gpios = <&gpiochip 24 1>;
                        default-state = "off";
                };
                port2right {
                        label = "port2:right";
                        gpios = <&gpiochip 25 1>;
                        default-state = "off";
                };
                port2left {
                        label = "port2:left";
                        gpios = <&gpiochip 26 1>;
                        default-state = "off";
                };
                port3right {
                        label = "port3:right";
                        gpios = <&gpiochip 27 1>;
                        default-state = "off";
                };
                port3left {
                        label = "port3:left";
                        gpios = <&gpiochip 28 1>;
                        default-state = "off";
                };
                port4right {
                        label = "port4:right";
                        gpios = <&gpiochip 29 1>;
                        default-state = "off";
                };
                port4left {
                        label = "port4:left";
                        gpios = <&gpiochip 30 1>;
                        default-state = "off";
                };
        };

	gpio-buttons {
		compatible = "gpio-keys-polled";
		autorepeat;
		poll-interval = <20>;
		button@1 {
			label = "soft_reset";
			linux,code = <0x198>;     // EV_RESTART
			linux,input-type = <1>;   // EV_KEY
			debounce-interval = <60>;
			gpios = <&gpiochip 6 1>;
		};
	};

        /* Subtract 32 from all IRQ numbers in device tree */
        intc: interrupt-controller@19021000 {
                interrupt-controller;
                compatible = "arm,cortex-a9-gic";
                #interrupt-cells = <3>;
                #address-cells = <1>;
                reg = <0x19021000 0x1000>,
                <0x19020100 0x100>;
        };

        uart0: uart@18000300 {
                // Required
                compatible = "ns16550A";
                reg = <0x18000300 0x08>;
                clock-frequency = <62500000>;   // uartclkdiv = 2. Kingpin has a higher clock rate.
                interrupts = <0 85 1>;          // non-PPI, 117 - 32, active high edge-triggered
                interrupt-parent = <&intc>;

                // Optional
                reg-shift = <0>;
                reg-offset = <0>;
                reg-io-width = <1>;
        };

        i2c-gpio {
            #address-cells = <1>;
            #size-cells = <0>;
            compatible = "i2c-gpio";
            gpios = <&gpiochip 5 0 /* sda */
                 &gpiochip 4 0>; /* scl */
            i2c-gpio,delay-us = <10>;   /* ~100 kHz */

            config_eeprom: at24@50 {
                compatible = "atmel,24c64";
                pagesize = <32>;
                reg = <0x50>;
            };

        };

        gpio-cfg {
                compatible = "iproc-gpio-cfg";
                gpios-general = <0 1 2 3 4 5 6 16 17 21 22 23 24 25 26 27 28 29 30 31>;
                gpios-aux = <33 34 35>;
                gpios-export = <1 0>, <16 1>, <17 1>;

        };

        pwm: pwm {
                compatible = "iproc-pwm";
                reg = <0x18031000 0x28>;
                #pwm-cells = <2>;
                chan0 {
                        channel = <1>;
                        active_low = <1>;
                };
                chan1 {
                        channel = <2>;
                        active_low = <1>;
                };
                chan2 {
                        channel = <3>;
                        active_low = <1>;
                };
        };

        board-data {
            compatible = "meraki,meraki-config";
            i2c-eeprom = <&config_eeprom>;
        };
};
