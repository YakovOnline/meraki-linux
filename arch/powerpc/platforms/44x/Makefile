
ifdef CONFIG_APM86xxx_SUSPEND
#
# Makefile section to generate apm86xxx_suspend_def.h
#
offsets-file := ../../../../include/asm/apm86xxx_suspend_def.h

always  := $(offsets-file)
targets := $(offsets-file)
targets += arch/powerpc/platforms/44x/apm86xxx_suspend_def.s

# Default sed regexp - multiline due to syntax constraints
define sed-y
	"/^->/{s:^->\([^ ]*\) [\$$#]*\([^ ]*\) \(.*\):#define \1 \2 /* \3 */:; s:->::; p;}"
endef

quiet_cmd_offsets = GEN     $@
define cmd_offsets
	(set -e; \
	 echo "#ifndef __APM86xxx_SUSPEND_DEF_H__"; \
	 echo "#define __APM86xxx_SUSPEND_DEF_H__"; \
	 echo "/*"; \
	 echo " * DO NOT MODIFY."; \
	 echo " *"; \
	 echo " * This file was generated by Makefile"; \
	 echo " *"; \
	 echo " */"; \
	 echo ""; \
	 sed -ne $(sed-y) $<; \
	 echo ""; \
	 echo "#endif" ) > $@
endef

# We use internal rules to avoid the "is up to date" message from make
arch/powerpc/platforms/44x/apm86xxx_suspend_def.s: arch/powerpc/platforms/44x/apm86xxx_suspend_def.c
	$(call if_changed_dep,cc_s_c)

$(obj)/$(offsets-file): arch/powerpc/platforms/44x/apm86xxx_suspend_def.s
	$(call cmd,offsets)

FORCE : $(obj)/$(offsets-file)

endif

#
# Normal Makefile section
#

obj-$(CONFIG_44x)	:= misc_44x.o idle.o
obj-$(CONFIG_PPC44x_SIMPLE) += ppc44x_simple.o
obj-$(CONFIG_EBONY)	+= ebony.o
obj-$(CONFIG_SERENGETI)	+= serengeti.o
obj-$(CONFIG_CASCADE)	+= serengeti.o
obj-$(CONFIG_SAM440EP) 	+= sam440ep.o
obj-$(CONFIG_WARP)	+= warp.o
obj-$(CONFIG_XILINX_VIRTEX_5_FXT) += virtex.o
obj-$(CONFIG_XILINX_ML510) += virtex_ml510.o
obj-$(CONFIG_BEECH)	+= beech-usb.o
obj-$(CONFIG_BLUESTONE)	+= bluestone-usb.o
obj-$(CONFIG_APM86xxx_SUSPEND)	+= apm86xxx_suspend.o apm86xxx_suspend_sys.o apm86xxx_suspend_asm.o
obj-$(CONFIG_APM86xxx_CPUFREQ)	+= apm86xxx_cpufreq.o
obj-$(CONFIG_PPC_CLOCK)	+= apm86xxx_clock.o
obj-$(CONFIG_SMP)       += smp.o

